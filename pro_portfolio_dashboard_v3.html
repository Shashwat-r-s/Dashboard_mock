<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Professional Portfolio Dashboard — Static Live Prototype (v3)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#0b1020; --panel:#12172a; --card:#0f1426; --ink:#e8ecf8; --muted:#9aa4bf; --line:#1e2643;
         --brand:#4f8cff; --ok:#30d158; --warn:#ffd60a; --bad:#ff453a; --accent:#a78bfa; --shadow:0 16px 32px rgba(0,0,0,.33); --radius:16px; }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:linear-gradient(180deg,#0b1020,#0c1227);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:1260px;margin:28px auto;padding:0 20px}
  h1{font-size:28px;margin:0 0 18px;letter-spacing:.2px}
  h2{font-size:20px;margin:0 0 10px}
  .grid{display:grid;grid-template-columns:340px 1fr;gap:18px}
  .panel{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
  .panel.pad{padding:16px 18px}
  .muted{color:var(--muted)}
  .note{font-size:12px;color:var(--muted)}
  .btn{display:inline-flex;gap:.5rem;align-items:center;background:var(--brand);color:#fff;border:none;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--ink)}
  .text{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#0a0f22;color:var(--ink);font-size:14px}
  label{font-size:12px;color:var(--muted);display:flex;align-items:center;gap:.4rem;margin:8px 0 6px}
  .divider{height:1px;background:var(--line);margin:14px 0}
  .info{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:#1a2350;color:#a5b4fc;font-weight:800;font-size:11px;cursor:help;position:relative}
  .info[data-tip]:hover::after,.info[data-tip]:focus::after{content:attr(data-tip);position:absolute;z-index:10;left:50%;transform:translateX(-50%);bottom:125%;min-width:220px;max-width:380px;background:#0b1020;color:#e8ecf8;border:1px solid #263058;border-radius:12px;padding:10px 12px;font-size:12px;box-shadow:var(--shadow);white-space:normal}
  .info[data-tip]:hover::before,.info[data-tip]:focus::before{content:"";position:absolute;left:50%;transform:translateX(-50%);bottom:112%;border:6px solid transparent;border-top-color:#0b1020}
  .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
  .metric{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px 16px}
  .metric h3{margin:0 0 8px;font-size:12px;color:var(--muted);display:flex;align-items:center;gap:.35rem;letter-spacing:.2px}
  .metric .v{font-size:22px;font-weight:800;letter-spacing:.2px}
  .chip{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700}
  .chip.ok{background:rgba(48,209,88,.18);color:var(--ok)}.chip.bad{background:rgba(255,69,58,.18);color:var(--bad)}
  .tabs{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
  .treemap{display:grid;grid-template-columns:repeat(8,1fr);grid-auto-rows:22px;gap:4px}
  .block{border-radius:6px}
  .g{background:#113a2e}.y{background:#3a3111}.r{background:#3a1111}
  table{border-collapse:collapse;width:100%}
  .heat{width:100%;font-size:12px}
  .heat th,.heat td{border:1px solid var(--line);padding:6px;text-align:center}
  .hm{border-radius:6px;padding:6px;color:#fff}
  .neg{background:#46222c}.neu{background:#1a2036}.pos{background:#1f3e29}
  .svgbox{width:100%;height:260px;display:block}
  .tbl{width:100%;border-collapse:collapse;font-size:13px}
  .tbl th,.tbl td{border:1px solid var(--line);padding:8px}
  .tbl th{background:#0d1430;text-align:left}
  .slider{appearance:none;width:320px;height:6px;border-radius:999px;background:#253057;outline:none}
  .slider::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:var(--brand);cursor:pointer}
  .sim-ctrls{display:flex;gap:24px;flex-wrap:wrap;align-items:center}
  .callout{background:#0b122d;border:1px solid var(--line);border-radius:12px;padding:12px}
  .row{display:flex;gap:8px;align-items:center}
  .row>*{flex:initial}
  .holdings{margin-top:10px;max-height:200px;overflow:auto;border:1px solid var(--line);border-radius:12px}
  .pill{display:inline-flex;gap:.35rem;align-items:center;padding:4px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;background:#0a1026}
  .badge{font-size:12px;color:#cbd5e1;background:#1a2350;border-radius:999px;padding:2px 6px;margin-left:6px}
  .mini{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .minicard{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px}
  .bar{height:8px;background:#263058;border-radius:999px;overflow:hidden}
  .bar>span{display:block;height:100%;background:var(--brand)}
  @media (max-width: 980px){.grid{grid-template-columns:1fr}.tabs{grid-template-columns:1fr}.metrics{grid-template-columns:repeat(2,1fr)}}
  @media (max-width: 560px){.metrics{grid-template-columns:1fr}.sim-ctrls{gap:12px}}
  body.light { background:#f7f8fc !important; color:#0b1020 !important; }
  body.light .panel{ background:#ffffff; border-color:#dfe3f0 }
  body.light .card{ background:#ffffff; border-color:#e7ebf6 }
  body.light .metric{ background:#ffffff; border-color:#e7ebf6 }
  body.light .text{ background:#ffffff; color:#0b1020; border-color:#dfe3f0 }
  body.light .tbl th{ background:#f2f5ff }
  body.light .pill{ background:#eef2ff; border-color:#d8defa }
  body.light .info{ background:#eef2ff; color:#334155 }
  body.light .hm.neg{ background:#ffd6db; color:#7f1d1d }
  body.light .hm.neu{ background:#e5e7eb; color:#1f2937 }
  body.light .hm.pos{ background:#d1fae5; color:#065f46 }
  @media print { body { background:#fff !important; color:#000 !important; } .panel,.card,.metric{ box-shadow:none !important; } .btn,.slider{ display:none !important; } .wrap{ max-width:100%; } }
</style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
    <h1>Professional Portfolio Risk & Allocation Dashboard</h1>
    <div style="display:flex;gap:8px">
      <button class="btn ghost" id="helpBtn" title="Glossary & beginner help (placeholder)">Help</button>
      <button class="btn" id="themeBtn" title="Toggle dark/light">Light / Dark</button>
    </div>
  </div>

  <div class="grid">
    <div class="panel pad">
      <h3 style="margin:0 0 8px;display:flex;gap:.5rem;align-items:center">Portfolio Builder <span class="badge" id="asset-count"></span></h3>
      <label>Symbol (type to search)<span class="info" data-tip="Start typing, suggestions appear. Example: AAPL, SPY, BTC.">i</span></label>
      <input id="symbol" class="text" list="symList" placeholder="e.g., SPY" />
      <datalist id="symList"></datalist>
      <label>Units <span class="info" data-tip="Enter how many units you hold.">i</span></label>
      <input id="units" class="text" type="number" min="0" step="1" value="10" />
      <div class="row" style="margin-top:10px">
        <button class="btn" id="addBtn">Add to Portfolio</button>
        <button class="btn ghost" id="clearBtn">Clear</button>
      </div>
      <div class="divider"></div>
      <div class="holdings" id="holdingsBox">
        <table class="tbl" aria-label="Current holdings">
          <thead><tr><th>Symbol</th><th>Name</th><th>Units</th><th>Price</th><th>Value</th><th></th></tr></thead>
          <tbody id="holdings"></tbody>
        </table>
      </div>
      <div style="display:flex;justify-content:space-between;margin-top:8px">
        <div class="pill">Total Value: <strong id="totalVal">$0</strong></div>
        <button class="btn ghost" id="exportBtn">Export CSV</button>
      </div>
      <div class="divider"></div>
      <h3 style="margin:0 0 6px">Preset</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn ghost" data-preset="balanced">Balanced (SPY, TLT, GLD, BTC, ETH)</button>
        <button class="btn ghost" data-preset="growth">Growth (SPY, QQQ, NVDA, BTC)</button>
        <button class="btn ghost" data-preset="defensive">Defensive (TLT, IEF, GLD, XLU)</button>
      </div>
    </div>

    <div>
      <div class="metrics">
        <div class="metric"><h3>Annual Return <span class="info" data-tip="Expected annualized return (from sample data).">i</span></h3><div class="v" id="kpi-ret">—</div><div class="chip ok" id="kpi-ret-chip">Above target</div></div>
        <div class="metric"><h3>Volatility <span class="info" data-tip="Annualized standard deviation estimate.">i</span></h3><div class="v" id="kpi-vol">—</div><div class="chip ok">Within band</div></div>
        <div class="metric"><h3>Sharpe <span class="info" data-tip="(Return − 2%) / Volatility.">i</span></h3><div class="v" id="kpi-sharpe">—</div><div class="chip ok">Healthy</div></div>
        <div class="metric"><h3>VaR / ES (95%) <span class="info" data-tip="1‑day Value‑at‑Risk / Expected Shortfall at 95% from sample vol.">i</span></h3><div class="v" id="kpi-var">—</div><div class="chip bad">Tail risk</div></div>
      </div>

      <div class="tabs">
        <div class="card">
          <h3 style="margin:0 0 10px;display:flex;gap:.5rem;align-items:center">Risk & Correlation <span class="info" data-tip="Left: risk contribution treemap. Right: correlation heatmap.">i</span></h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div><div class="muted" style="margin-bottom:6px">Risk Contribution (Treemap)</div><div class="treemap" id="treemap" aria-hidden="true"></div></div>
            <div><div class="muted" style="margin-bottom:6px">Correlation Heatmap (ρ)</div><table class="heat" aria-label="Correlation matrix"><thead><tr id="corr-head"><th></th></tr></thead><tbody id="corr-body"></tbody></table></div>
          </div>
        </div>
        <div class="card">
          <h3 style="margin:0 0 10px;display:flex;gap:.5rem;align-items:center">Performance & Rebalancing <span class="info" data-tip="Top: normalized performance (simulated). Bottom: equal-weight rebalance suggestions.">i</span></h3>
          <svg class="svgbox" id="lineChart" role="img" aria-label="Portfolio performance line"></svg>
          <div class="divider"></div>
          <table class="tbl" aria-label="Rebalancing suggestions">
            <thead><tr><th>Asset</th><th>Current %</th><th>Target %</th><th>Diff</th><th>Action</th></tr></thead>
            <tbody id="rebal"></tbody>
          </table>
          <div class="note" style="margin-top:8px"><span class="info" data-tip="Rebalance when deviation ≥2% from target.">i</span> Threshold policy: ±2% band</div>
        </div>
      </div>
    </div>
  </div>

  <div class="panel pad" style="margin-top:18px">
    <h2 style="display:flex;gap:.5rem;align-items:center">🔑 HD Feature Widgets <span class="info" data-tip="Interactive exhibits for explainability, scenarios, attribution and export.">i</span></h2>

    <div class="mini" style="margin-top:8px">
      <div class="minicard">
        <h4 style="margin:0 0 8px">Explainability & Narrative</h4>
        <div class="callout" id="narrativeBox">Choose a preset or add assets to generate an insight.</div>
        <div class="bar" style="margin-top:8px"><span id="riskBar" style="width:0%"></span></div>
        <div class="note" style="margin-top:6px">Risk driver: <span id="riskDriver">—</span></div>
      </div>

      <div class="minicard">
        <h4 style="margin:0 0 8px">Advanced Metrics</h4>
        <div class="callout">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div><strong>Maximum Drawdown</strong><br><span class="muted">–18%</span></div>
            <div><strong>Sortino Ratio</strong><br><span class="muted">1.45</span></div>
            <div style="grid-column:1 / -1"><strong>Expected Shortfall (95%)</strong><br><span class="muted">BTC –9%, ETH –5%, SPY –2%</span></div>
          </div>
        </div>
      </div>

      <div class="minicard">
        <h4 style="margin:0 0 8px">Dynamic Scenarios</h4>
        <div class="sim-ctrls">
          <div><label>Equity Shock (%)</label><input class="slider" id="eqShock" type="range" min="-20" max="20" value="5" /></div>
          <div><label>Crypto Shock (%)</label><input class="slider" id="crShock" type="range" min="-30" max="30" value="-8" /></div>
          <div><label>Rates ↑ (bps)</label><input class="slider" id="rtShock" type="range" min="-150" max="150" value="50" /></div>
        </div>
        <svg class="svgbox" id="scenarioChart" role="img" aria-label="Scenario comparison"></svg>
      </div>
    </div>

    <div class="mini" style="margin-top:12px">
      <div class="minicard">
        <h4 style="margin:0 0 8px">AI Insights</h4>
        <div class="row" style="margin-bottom:8px">
          <button class="btn" id="runAI">Run AI Analysis</button>
          <span class="note">Advanced analysis from your current portfolio.</span>
        </div>
        <div class="callout" id="aiBox">Add assets or choose a preset, then click <b>Run AI Analysis</b>.</div>
      </div>

      <div class="minicard">
        <h4 style="margin:0 0 8px">Attribution & Factors</h4>
        <svg class="svgbox" id="attribChart" role="img" aria-label="Attribution bars"></svg>
        <div class="note">Shows contribution by Equity / Bonds / Commodities / Crypto.</div>
      </div>

      <div class="minicard">
        <h4 style="margin:0 0 8px">UX, Benchmarks & Export</h4>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
          <span class="pill" title="Compare your portfolio vs an equal-weight baseline">Equal‑Weight</span>
          <span class="pill" title="Classic 60% equity / 40% bonds reference">60/40</span>
          <span class="pill" title="Market-like benchmark">SPY</span>
        </div>
        <ul style="margin:0 0 8px 18px">
          <li>Benchmark vs. <b>Equal‑Weight</b> & <b>60/40</b></li>
          <li>Color‑blind safe palette & accessible labels</li>
          <li>Export to <b>PDF</b>/<b>CSV</b> (prototype)</li>
        </ul>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="exportAll">Export All Data CSV</button>
          <button class="btn ghost" id="exportPDF">Export PDF</button>
        </div>
      </div>
    </div>
  </div>

  <footer style="margin:20px 0 10px;color:var(--muted);font-size:12px;text-align:center">
    Static live prototype (v3). All numbers are illustrative placeholders.
  </footer>
</div>

<script>
const DB = [{"symbol": "AAPL", "name": "Apple Inc.", "assetClass": "Equity", "subType": "Stock", "group": "Tech", "price": 385.46, "vol": 6.0, "ret1y": -8.0}, {"symbol": "SPY", "name": "SPDR S&P 500 ETF", "assetClass": "ETF", "subType": "Equity ETF", "group": "Broad Market", "price": 137.81, "vol": 34.5, "ret1y": 24.1}, {"symbol": "TLT", "name": "iShares 20+ Year Treasury Bond ETF", "assetClass": "ETF", "subType": "Bond ETF", "group": "Treasury Long", "price": 535.85, "vol": 8.5, "ret1y": 3.8}, {"symbol": "BTC", "name": "Bitcoin", "assetClass": "Crypto", "subType": "Crypto", "group": "Digital Asset", "price": 1936.83, "vol": 57.5, "ret1y": 61.3}, {"symbol": "ETH", "name": "Ethereum", "assetClass": "Crypto", "subType": "Crypto", "group": "Digital Asset", "price": 1724.85, "vol": 55.9, "ret1y": 96.0}, {"symbol": "SYM1", "name": "Sample 1", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 329.24, "vol": 13.8, "ret1y": 17.1}, {"symbol": "SYM2", "name": "Sample 2", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 52612.98, "vol": 40.5, "ret1y": 133.4}, {"symbol": "SYM3", "name": "Sample 3", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 420.39, "vol": 18.6, "ret1y": -17.6}, {"symbol": "SYM4", "name": "Sample 4", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 574.54, "vol": 18.5, "ret1y": -22.6}, {"symbol": "SYM5", "name": "Sample 5", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 6286.57, "vol": 107.8, "ret1y": 84.9}, {"symbol": "SYM6", "name": "Sample 6", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 485.24, "vol": 34.2, "ret1y": 12.9}, {"symbol": "SYM7", "name": "Sample 7", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 584.0, "vol": 20.1, "ret1y": 14.2}, {"symbol": "SYM8", "name": "Sample 8", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 53911.3, "vol": 89.5, "ret1y": 146.8}, {"symbol": "SYM9", "name": "Sample 9", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 348.52, "vol": 33.2, "ret1y": -26.3}, {"symbol": "SYM10", "name": "Sample 10", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 140.6, "vol": 16.6, "ret1y": -23.6}, {"symbol": "SYM11", "name": "Sample 11", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 15131.42, "vol": 48.1, "ret1y": 6.7}, {"symbol": "SYM12", "name": "Sample 12", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 383.23, "vol": 19.6, "ret1y": -0.4}, {"symbol": "SYM13", "name": "Sample 13", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 129.66, "vol": 15.7, "ret1y": 44.9}, {"symbol": "SYM14", "name": "Sample 14", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 42122.3, "vol": 88.7, "ret1y": -18.9}, {"symbol": "SYM15", "name": "Sample 15", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 438.83, "vol": 11.5, "ret1y": 0.4}, {"symbol": "SYM16", "name": "Sample 16", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 593.77, "vol": 30.6, "ret1y": 14.6}, {"symbol": "SYM17", "name": "Sample 17", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 44499.93, "vol": 107.4, "ret1y": 126.2}, {"symbol": "SYM18", "name": "Sample 18", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 141.28, "vol": 6.3, "ret1y": -4.8}, {"symbol": "SYM19", "name": "Sample 19", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 164.31, "vol": 13.4, "ret1y": 45.4}, {"symbol": "SYM20", "name": "Sample 20", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 56963.9, "vol": 65.2, "ret1y": 97.3}, {"symbol": "SYM21", "name": "Sample 21", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 240.4, "vol": 41.6, "ret1y": 6.7}, {"symbol": "SYM22", "name": "Sample 22", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 162.6, "vol": 14.9, "ret1y": 14.9}, {"symbol": "SYM23", "name": "Sample 23", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 17078.21, "vol": 86.8, "ret1y": 155.5}, {"symbol": "SYM24", "name": "Sample 24", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 242.64, "vol": 13.8, "ret1y": 49.8}, {"symbol": "SYM25", "name": "Sample 25", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 308.17, "vol": 8.6, "ret1y": -26.2}, {"symbol": "SYM26", "name": "Sample 26", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 7127.2, "vol": 90.2, "ret1y": 130.1}, {"symbol": "SYM27", "name": "Sample 27", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 256.19, "vol": 7.5, "ret1y": 0.5}, {"symbol": "SYM28", "name": "Sample 28", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 597.69, "vol": 26.2, "ret1y": 47.7}, {"symbol": "SYM29", "name": "Sample 29", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 55950.68, "vol": 40.9, "ret1y": 113.0}, {"symbol": "SYM30", "name": "Sample 30", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 410.62, "vol": 26.5, "ret1y": -8.7}, {"symbol": "SYM31", "name": "Sample 31", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 386.37, "vol": 9.5, "ret1y": 4.8}, {"symbol": "SYM32", "name": "Sample 32", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 29492.05, "vol": 116.3, "ret1y": 150.2}, {"symbol": "SYM33", "name": "Sample 33", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 161.72, "vol": 25.0, "ret1y": -15.7}, {"symbol": "SYM34", "name": "Sample 34", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 548.01, "vol": 39.8, "ret1y": -6.1}, {"symbol": "SYM35", "name": "Sample 35", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 41531.72, "vol": 88.7, "ret1y": -23.3}, {"symbol": "SYM36", "name": "Sample 36", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 458.69, "vol": 26.6, "ret1y": 32.3}, {"symbol": "SYM37", "name": "Sample 37", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 320.56, "vol": 5.0, "ret1y": -4.1}, {"symbol": "SYM38", "name": "Sample 38", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 1266.0, "vol": 114.3, "ret1y": 150.9}, {"symbol": "SYM39", "name": "Sample 39", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 499.84, "vol": 17.3, "ret1y": -25.4}, {"symbol": "SYM40", "name": "Sample 40", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 527.42, "vol": 42.9, "ret1y": -23.1}, {"symbol": "SYM41", "name": "Sample 41", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 31589.39, "vol": 45.5, "ret1y": 122.5}, {"symbol": "SYM42", "name": "Sample 42", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 460.67, "vol": 10.1, "ret1y": 8.0}, {"symbol": "SYM43", "name": "Sample 43", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 332.13, "vol": 15.6, "ret1y": 39.8}, {"symbol": "SYM44", "name": "Sample 44", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 27503.97, "vol": 56.9, "ret1y": 69.4}, {"symbol": "SYM45", "name": "Sample 45", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 439.31, "vol": 13.0, "ret1y": -5.1}, {"symbol": "SYM46", "name": "Sample 46", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 597.11, "vol": 31.0, "ret1y": 5.0}, {"symbol": "SYM47", "name": "Sample 47", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 33642.43, "vol": 49.7, "ret1y": -6.1}, {"symbol": "SYM48", "name": "Sample 48", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 206.16, "vol": 28.5, "ret1y": -11.6}, {"symbol": "SYM49", "name": "Sample 49", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 136.03, "vol": 7.8, "ret1y": 20.5}, {"symbol": "SYM50", "name": "Sample 50", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 14881.22, "vol": 112.4, "ret1y": 146.3}, {"symbol": "SYM51", "name": "Sample 51", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 47.16, "vol": 14.5, "ret1y": 23.5}, {"symbol": "SYM52", "name": "Sample 52", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 132.47, "vol": 10.3, "ret1y": 44.8}, {"symbol": "SYM53", "name": "Sample 53", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 37117.81, "vol": 77.8, "ret1y": 128.3}, {"symbol": "SYM54", "name": "Sample 54", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 485.46, "vol": 12.6, "ret1y": -22.2}, {"symbol": "SYM55", "name": "Sample 55", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 261.48, "vol": 21.9, "ret1y": 7.4}, {"symbol": "SYM56", "name": "Sample 56", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 47389.93, "vol": 93.9, "ret1y": 176.2}, {"symbol": "SYM57", "name": "Sample 57", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 63.56, "vol": 21.1, "ret1y": -2.9}, {"symbol": "SYM58", "name": "Sample 58", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 517.7, "vol": 14.9, "ret1y": -14.8}, {"symbol": "SYM59", "name": "Sample 59", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 29159.89, "vol": 73.8, "ret1y": 6.9}, {"symbol": "SYM60", "name": "Sample 60", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 153.63, "vol": 41.9, "ret1y": 5.5}, {"symbol": "SYM61", "name": "Sample 61", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 517.5, "vol": 27.0, "ret1y": -26.0}, {"symbol": "SYM62", "name": "Sample 62", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 64953.36, "vol": 106.9, "ret1y": 172.6}, {"symbol": "SYM63", "name": "Sample 63", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 556.19, "vol": 38.9, "ret1y": -16.7}, {"symbol": "SYM64", "name": "Sample 64", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 293.96, "vol": 13.5, "ret1y": 2.1}, {"symbol": "SYM65", "name": "Sample 65", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 3811.31, "vol": 70.3, "ret1y": 176.5}, {"symbol": "SYM66", "name": "Sample 66", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 162.8, "vol": 36.4, "ret1y": 6.4}, {"symbol": "SYM67", "name": "Sample 67", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 256.69, "vol": 43.3, "ret1y": 49.6}, {"symbol": "SYM68", "name": "Sample 68", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 36124.95, "vol": 97.5, "ret1y": -22.8}, {"symbol": "SYM69", "name": "Sample 69", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 181.54, "vol": 43.7, "ret1y": 16.3}, {"symbol": "SYM70", "name": "Sample 70", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 327.61, "vol": 34.9, "ret1y": -25.4}, {"symbol": "SYM71", "name": "Sample 71", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 37971.55, "vol": 80.2, "ret1y": 144.7}, {"symbol": "SYM72", "name": "Sample 72", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 98.67, "vol": 43.4, "ret1y": -23.6}, {"symbol": "SYM73", "name": "Sample 73", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 115.57, "vol": 28.8, "ret1y": 24.0}, {"symbol": "SYM74", "name": "Sample 74", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 15288.26, "vol": 49.6, "ret1y": 153.7}, {"symbol": "SYM75", "name": "Sample 75", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 151.5, "vol": 28.8, "ret1y": 19.6}, {"symbol": "SYM76", "name": "Sample 76", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 254.44, "vol": 28.3, "ret1y": 11.8}, {"symbol": "SYM77", "name": "Sample 77", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 60755.91, "vol": 56.3, "ret1y": 111.9}, {"symbol": "SYM78", "name": "Sample 78", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 147.02, "vol": 20.8, "ret1y": 23.7}, {"symbol": "SYM79", "name": "Sample 79", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 183.5, "vol": 17.6, "ret1y": 30.1}, {"symbol": "SYM80", "name": "Sample 80", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 4715.31, "vol": 76.7, "ret1y": 179.6}, {"symbol": "SYM81", "name": "Sample 81", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 597.68, "vol": 7.9, "ret1y": -12.9}, {"symbol": "SYM82", "name": "Sample 82", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 162.79, "vol": 42.3, "ret1y": 40.5}, {"symbol": "SYM83", "name": "Sample 83", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 57152.57, "vol": 69.6, "ret1y": -22.1}, {"symbol": "SYM84", "name": "Sample 84", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 501.08, "vol": 33.1, "ret1y": 18.9}, {"symbol": "SYM85", "name": "Sample 85", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 592.4, "vol": 31.2, "ret1y": -29.4}, {"symbol": "SYM86", "name": "Sample 86", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 53111.77, "vol": 64.0, "ret1y": 99.2}, {"symbol": "SYM87", "name": "Sample 87", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 563.66, "vol": 10.4, "ret1y": -20.8}, {"symbol": "SYM88", "name": "Sample 88", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 68.69, "vol": 27.1, "ret1y": -8.2}, {"symbol": "SYM89", "name": "Sample 89", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 39313.94, "vol": 97.4, "ret1y": -11.1}, {"symbol": "SYM90", "name": "Sample 90", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 382.37, "vol": 15.6, "ret1y": 9.1}, {"symbol": "SYM91", "name": "Sample 91", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 543.68, "vol": 38.8, "ret1y": -22.6}, {"symbol": "SYM92", "name": "Sample 92", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 27532.43, "vol": 62.1, "ret1y": -59.1}, {"symbol": "SYM93", "name": "Sample 93", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 463.82, "vol": 30.5, "ret1y": -9.0}, {"symbol": "SYM94", "name": "Sample 94", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 446.03, "vol": 27.1, "ret1y": 4.2}, {"symbol": "SYM95", "name": "Sample 95", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 628.54, "vol": 46.0, "ret1y": 151.9}, {"symbol": "SYM96", "name": "Sample 96", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 542.84, "vol": 26.8, "ret1y": 36.8}, {"symbol": "SYM97", "name": "Sample 97", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 351.59, "vol": 10.9, "ret1y": -19.8}, {"symbol": "SYM98", "name": "Sample 98", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 20036.8, "vol": 111.9, "ret1y": 131.1}, {"symbol": "SYM99", "name": "Sample 99", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 517.12, "vol": 41.0, "ret1y": -13.2}, {"symbol": "SYM100", "name": "Sample 100", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 153.47, "vol": 9.1, "ret1y": 32.4}, {"symbol": "SYM101", "name": "Sample 101", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 57468.76, "vol": 72.5, "ret1y": 89.0}, {"symbol": "SYM102", "name": "Sample 102", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 96.96, "vol": 42.2, "ret1y": 39.2}, {"symbol": "SYM103", "name": "Sample 103", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 585.84, "vol": 37.4, "ret1y": 40.5}, {"symbol": "SYM104", "name": "Sample 104", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 1611.12, "vol": 98.9, "ret1y": 19.7}, {"symbol": "SYM105", "name": "Sample 105", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 558.84, "vol": 37.1, "ret1y": 39.1}, {"symbol": "SYM106", "name": "Sample 106", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 487.4, "vol": 15.7, "ret1y": 33.0}, {"symbol": "SYM107", "name": "Sample 107", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 7026.22, "vol": 109.8, "ret1y": 146.1}, {"symbol": "SYM108", "name": "Sample 108", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 137.35, "vol": 37.7, "ret1y": 6.8}, {"symbol": "SYM109", "name": "Sample 109", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 186.59, "vol": 36.8, "ret1y": -11.8}, {"symbol": "SYM110", "name": "Sample 110", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 1538.2, "vol": 55.5, "ret1y": 18.8}, {"symbol": "SYM111", "name": "Sample 111", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 519.29, "vol": 43.7, "ret1y": -7.7}, {"symbol": "SYM112", "name": "Sample 112", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 386.68, "vol": 21.0, "ret1y": 48.5}, {"symbol": "SYM113", "name": "Sample 113", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 34854.03, "vol": 115.1, "ret1y": -32.3}, {"symbol": "SYM114", "name": "Sample 114", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 582.39, "vol": 12.1, "ret1y": 47.0}, {"symbol": "SYM115", "name": "Sample 115", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 162.95, "vol": 9.3, "ret1y": 4.8}, {"symbol": "SYM116", "name": "Sample 116", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 47355.43, "vol": 65.1, "ret1y": 85.5}, {"symbol": "SYM117", "name": "Sample 117", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 309.3, "vol": 20.4, "ret1y": 16.1}, {"symbol": "SYM118", "name": "Sample 118", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 156.56, "vol": 33.4, "ret1y": -29.9}, {"symbol": "SYM119", "name": "Sample 119", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 60162.39, "vol": 83.1, "ret1y": 112.7}, {"symbol": "SYM120", "name": "Sample 120", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 446.46, "vol": 31.8, "ret1y": -0.9}, {"symbol": "SYM121", "name": "Sample 121", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 46.63, "vol": 31.6, "ret1y": -3.6}, {"symbol": "SYM122", "name": "Sample 122", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 20404.52, "vol": 107.8, "ret1y": 112.7}, {"symbol": "SYM123", "name": "Sample 123", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 183.69, "vol": 17.4, "ret1y": 2.7}, {"symbol": "SYM124", "name": "Sample 124", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 244.43, "vol": 16.8, "ret1y": -19.8}, {"symbol": "SYM125", "name": "Sample 125", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 27329.02, "vol": 115.2, "ret1y": 102.6}, {"symbol": "SYM126", "name": "Sample 126", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 542.17, "vol": 29.6, "ret1y": -5.9}, {"symbol": "SYM127", "name": "Sample 127", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 331.02, "vol": 5.0, "ret1y": -7.0}, {"symbol": "SYM128", "name": "Sample 128", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 27942.74, "vol": 86.4, "ret1y": 97.1}, {"symbol": "SYM129", "name": "Sample 129", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 281.67, "vol": 22.7, "ret1y": -12.9}, {"symbol": "SYM130", "name": "Sample 130", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 286.55, "vol": 41.0, "ret1y": 33.7}, {"symbol": "SYM131", "name": "Sample 131", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 11029.95, "vol": 46.8, "ret1y": 63.7}, {"symbol": "SYM132", "name": "Sample 132", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 381.6, "vol": 18.4, "ret1y": 35.5}, {"symbol": "SYM133", "name": "Sample 133", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 451.93, "vol": 31.9, "ret1y": -12.0}, {"symbol": "SYM134", "name": "Sample 134", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 12943.45, "vol": 42.0, "ret1y": -1.2}, {"symbol": "SYM135", "name": "Sample 135", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 287.71, "vol": 39.0, "ret1y": -24.2}, {"symbol": "SYM136", "name": "Sample 136", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 251.59, "vol": 30.2, "ret1y": -14.4}, {"symbol": "SYM137", "name": "Sample 137", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 45263.03, "vol": 79.6, "ret1y": -1.4}, {"symbol": "SYM138", "name": "Sample 138", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 395.35, "vol": 5.2, "ret1y": 30.1}, {"symbol": "SYM139", "name": "Sample 139", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 463.18, "vol": 9.3, "ret1y": 4.0}, {"symbol": "SYM140", "name": "Sample 140", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 11432.64, "vol": 116.6, "ret1y": 64.3}, {"symbol": "SYM141", "name": "Sample 141", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 34.88, "vol": 15.0, "ret1y": 37.9}, {"symbol": "SYM142", "name": "Sample 142", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 276.59, "vol": 37.1, "ret1y": 23.4}, {"symbol": "SYM143", "name": "Sample 143", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 64213.01, "vol": 87.6, "ret1y": 168.0}, {"symbol": "SYM144", "name": "Sample 144", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 535.4, "vol": 29.5, "ret1y": 27.5}, {"symbol": "SYM145", "name": "Sample 145", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 305.34, "vol": 38.2, "ret1y": 13.8}, {"symbol": "SYM146", "name": "Sample 146", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 58318.53, "vol": 99.5, "ret1y": 53.9}, {"symbol": "SYM147", "name": "Sample 147", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 159.22, "vol": 14.9, "ret1y": 21.0}, {"symbol": "SYM148", "name": "Sample 148", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 460.66, "vol": 25.9, "ret1y": 20.1}, {"symbol": "SYM149", "name": "Sample 149", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 17848.84, "vol": 46.2, "ret1y": 8.6}, {"symbol": "SYM150", "name": "Sample 150", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 166.67, "vol": 17.8, "ret1y": 13.2}, {"symbol": "SYM151", "name": "Sample 151", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 87.33, "vol": 14.3, "ret1y": 25.5}, {"symbol": "SYM152", "name": "Sample 152", "assetClass": "Crypto", "subType": "Stock", "group": "Synthetic", "price": 45917.25, "vol": 45.1, "ret1y": 37.8}, {"symbol": "SYM153", "name": "Sample 153", "assetClass": "Equity", "subType": "Stock", "group": "Synthetic", "price": 327.85, "vol": 21.6, "ret1y": -13.5}, {"symbol": "SYM154", "name": "Sample 154", "assetClass": "ETF", "subType": "Stock", "group": "Synthetic", "price": 254.99, "vol": 41.2, "ret1y": 16.7}];
const DB_MAP = new Map(DB.map(d => [d.symbol.toUpperCase(), d]));
const symList = document.getElementById('symList');
const assetCount = document.getElementById('asset-count');
assetCount.textContent = DB.length + " assets";
DB.forEach(d => { const opt=document.createElement('option'); opt.value=d.symbol; opt.label=d.name + " — " + d.assetClass + (d.subType?(" / "+d.subType):""); symList.appendChild(opt); });

function lev(a,b){const m=[];for(let i=0;i<=b.length;i++)m[i]=[i];for(let j=0;j<=a.length;j++)m[0][j]=j;for(let i=1;i<=b.length;i++)for(let j=1;j<=a.length;j++)m[i][j]=b.charAt(i-1)==a.charAt(j-1)?m[i-1][j-1]:Math.min(m[i-1][j-1]+1,m[i][j-1]+1,m[i-1][j]+1);return m[b.length][a.length];}
const symbolInput = document.getElementById('symbol');
symbolInput.addEventListener('input', ()=>{ const q=symbolInput.value.trim().toUpperCase(); if(!q) return; const ranked=DB.map(d=>({sym:d.symbol,score:lev(q,d.symbol.toUpperCase())})).sort((a,b)=>a.score-b.score).slice(0,5); symbolInput.setAttribute('title',"Suggestions: "+ranked.map(r=>r.sym).join(', ')); });

const holdingsTBody = document.getElementById('holdings'); const totalValEl = document.getElementById('totalVal'); let portfolio=[];
function formatMoney(x){return '$' + x.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}
function renderHoldings(){holdingsTBody.innerHTML=''; portfolio.forEach(h=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${h.symbol}</td><td>${h.name}</td><td>${h.units}</td><td>${formatMoney(h.price)}</td><td>${formatMoney(h.units*h.price)}</td><td><button class="btn ghost" onclick="removeHolding('${h.symbol}')">Remove</button></td>`; holdingsTBody.appendChild(tr); });}
function addHolding(sym,units){ sym=(sym||'').toUpperCase(); if(!DB_MAP.has(sym)){alert('Symbol not found in local DB.'); return;} const d=DB_MAP.get(sym); const ex=portfolio.find(x=>x.symbol===sym); if(ex){ex.units+=units;} else {portfolio.push({symbol:d.symbol,name:d.name,units:units,price:d.price,assetClass:d.assetClass,subType:d.subType,group:d.group,vol:d.vol,ret1y:d.ret1y});} renderHoldings(); recalc(); }
function removeHolding(sym){ portfolio = portfolio.filter(h=>h.symbol!==sym); renderHoldings(); recalc(); }

document.getElementById('addBtn').onclick=()=>{ const sym=document.getElementById('symbol').value; const units=parseFloat(document.getElementById('units').value||'0'); if(!sym || units<=0) return alert('Enter a valid symbol and units.'); addHolding(sym, units); };
document.getElementById('clearBtn').onclick=()=>{ portfolio=[]; renderHoldings(); recalc(); };

const presets={ balanced:[['SPY',20],['TLT',20],['GLD',10],['BTC',40],['ETH',10]], growth:[['SPY',30],['QQQ',30],['NVDA',10],['BTC',30]], defensive:[['TLT',40],['IEF',20],['GLD',20],['XLU',20]] };
document.querySelectorAll('[data-preset]').forEach(btn=>{ btn.onclick=()=>{ portfolio=[]; presets[btn.dataset.preset].forEach(([s,w])=>{ const d=DB_MAP.get(s); const total=100000; const targetVal=total*w/100; const units=Math.max(1, Math.round(targetVal/d.price)); addHolding(s, units); }); renderHoldings(); recalc(); }});

function weights(){ const total=portfolio.reduce((s,h)=>s+h.units*h.price,0)||1; return portfolio.map(h=>({symbol:h.symbol,w:(h.units*h.price)/total,vol:h.vol,ret:h.ret1y,assetClass:h.assetClass})); }
function drawKPIs(){ const w=weights(); const ret=w.reduce((s,x)=>s+(x.ret/100)*x.w,0); const vol=Math.sqrt(w.reduce((s,x)=>s+Math.pow((x.vol/100)*x.w,2),0)); const rf=0.02; const sharpe=(ret-rf)/(vol||1); const dayVol=vol/Math.sqrt(252); const var95=1.65*dayVol; const es95=2.06*dayVol; document.getElementById('kpi-ret').textContent=(ret*100).toFixed(1)+'%'; document.getElementById('kpi-vol').textContent=(vol*100).toFixed(1)+'%'; document.getElementById('kpi-sharpe').textContent=sharpe.toFixed(2); document.getElementById('kpi-var').textContent=(var95*100).toFixed(1)+'% / '+(es95*100).toFixed(1)+'%'; }
function drawTreemap(){ const el=document.getElementById('treemap'); el.innerHTML=''; const w=weights(); w.sort((a,b)=>(b.w*b.vol)-(a.w*a.vol)); const mapClass=(sym)=>{ const ac=(DB_MAP.get(sym)||{}).assetClass; return ac==='Crypto'?'r':(ac==='Equity'?'g':'y'); }; w.forEach(x=>{ const area=1+Math.round(8*(x.w*x.vol)/((w[0]||{w:1,vol:1}).w*(w[0]||{w:1,vol:1}).vol||1)); const div=document.createElement('div'); div.className='block '+mapClass(x.symbol); div.style.gridColumn='span '+Math.max(1, Math.min(8, area)); div.style.gridRow='span '+Math.max(1, Math.min(4, Math.round(area/2))); div.title=x.symbol+' · weight '+(x.w*100).toFixed(1)+'% · risk '+(x.vol).toFixed(1)+'%'; el.appendChild(div); }); }
function corrPair(a,b){ if(a===b) return 1.0; const A=(DB_MAP.get(a)||{}).assetClass; const B=(DB_MAP.get(b)||{}).assetClass; if(A==='Equity' && B==='Equity') return 0.8; if((A==='Equity'&&B==='ETF')||(A==='ETF'&&B==='Equity')) return 0.6; if(A==='ETF' && B==='ETF') return 0.7; if((A==='Equity'&&B==='Bond')||(A==='Bond'&&B==='Equity')) return -0.3; if((A==='ETF'||A==='Equity') && B==='Crypto') return 0.2; if(A==='Crypto' && B==='Crypto') return 0.7; if((A==='Commodity'||B==='Commodity')) return 0.1; return 0.0; }
function drawCorr(){ const syms=portfolio.map(h=>h.symbol).slice(0,6); const head=document.getElementById('corr-head'); const body=document.getElementById('corr-body'); head.innerHTML='<th></th>'+syms.map(s=>'<th>'+s+'</th>').join(''); body.innerHTML=''; syms.forEach(r=>{ const tr=document.createElement('tr'); tr.innerHTML='<th>'+r+'</th>'+syms.map(c=>{ const v=corrPair(r,c); const cls=v>0.3?'pos':(v<-0.1?'neg':'neu'); return '<td class="hm '+cls+'">'+v.toFixed(2)+'</td>'; }).join(''); body.appendChild(tr); }); }
function drawLine(){ const svg=document.getElementById('lineChart'); const W=svg.clientWidth||560,H=svg.clientHeight||260; svg.setAttribute('viewBox',`0 0 ${W} ${H}`); const vol=(weights().reduce((s,x)=>s+x.vol*x.w,0)||10)/100; let y=100; const pts=[]; for(let i=0;i<80;i++){ y*=(1+(Math.random()-0.5)*vol*0.2); pts.push([i,y]); } const ys=pts.map(p=>p[1]); const xScale=x=>20+x*(W-40)/80; const yMin=Math.min(...ys), yMax=Math.max(...ys); const yScale=y=>H-20-(y-yMin)*(H-40)/(yMax-yMin||1); const d=pts.map((p,i)=> (i?'L':'M') + xScale(p[0])+','+yScale(p[1])).join(' '); svg.innerHTML = `<path d="${d}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--brand')}" stroke-width="2"/>`; }
function drawRebal(){ const tbody=document.getElementById('rebal'); tbody.innerHTML = ''; const n=Math.max(1, portfolio.length); const target=100/n; const total=portfolio.reduce((s,h)=>s+h.units*h.price,0)||1; portfolio.forEach(h=>{ const cur=(h.units*h.price)/total*100; const diff=cur-target; const action=Math.abs(diff)<2?'Hold':(diff>0?'Sell '+Math.abs(diff).toFixed(1)+'%':'Buy '+Math.abs(diff).toFixed(1)+'%'); const tr=document.createElement('tr'); tr.innerHTML = `<td>${h.symbol}</td><td>${cur.toFixed(1)}%</td><td>${target.toFixed(1)}%</td><td>${(diff>0?'+':'')}${diff.toFixed(1)}%</td><td>${action}</td>`; tbody.appendChild(tr); }); }
function drawNarrative(){ const w=weights(); if(!w.length){ document.getElementById('narrativeBox').textContent='Choose a preset or add assets to generate an insight.'; document.getElementById('riskBar').style.width='0%'; document.getElementById('riskDriver').textContent='—'; return; } const totalCrypto=w.filter(x=>x.assetClass==='Crypto').reduce((s,x)=>s+x.w,0); const totalBonds=w.filter(x=>x.subType==='Bond ETF').reduce((s,x)=>s+x.w,0); const riskPct=Math.min(100, Math.round((w.reduce((s,x)=>s + x.w*x.vol,0))*1.2)); const loss$=Math.round(12000 * (totalCrypto*1.5 + 0.5)); const text=`At current allocation, a 5% tail event implies ~ $${loss$} one‑day loss; crypto drives risk while bonds cushion volatility.`; document.getElementById('narrativeBox').textContent=text; document.getElementById('riskBar').style.width=riskPct+'%'; const driver= totalCrypto>0.25?'Crypto Exposure':'Equity Beta'; document.getElementById('riskDriver').textContent = driver + (totalBonds>0.2?' · Bonds hedge active':''); }
document.getElementById('eqShock').oninput=drawScenario; document.getElementById('crShock').oninput=drawScenario; document.getElementById('rtShock').oninput=drawScenario;
function drawScenario(){ const svg=document.getElementById('scenarioChart'); const W=svg.clientWidth||560,H=svg.clientHeight||260; svg.setAttribute('viewBox',`0 0 ${W} ${H}`); const eq=parseFloat(document.getElementById('eqShock').value); const cr=parseFloat(document.getElementById('crShock').value); const rt=parseFloat(document.getElementById('rtShock').value); let y0=100,y1=100; const w=weights(); const wEq=w.filter(x=>x.assetClass==='Equity'||x.subType==='Equity ETF').reduce((s,x)=>s+x.w,0); const wBd=w.filter(x=>x.subType==='Bond ETF').reduce((s,x)=>s+x.w,0); const wCr=w.filter(x=>x.assetClass==='Crypto').reduce((s,x)=>s+x.w,0); const pts0=[], pts1=[]; for(let i=0;i<60;i++){ y0 *= (1+(Math.random()-0.5)*0.01); pts0.push([i,y0]); } for(let i=0;i<60;i++){ let shock=0; if(i<10) shock = (eq/100)*wEq + (cr/100)*wCr + (-rt/10000)*wBd*8; y1 *= (1 + (Math.random()-0.5)*0.01 + shock/10); pts1.push([i,y1]); } function scale(pts){ const xs=pts.map(p=>p[0]), ys=pts.map(p=>p[1]); const xScale=x=> 20 + x*(W-40)/60; const yMin=Math.min(...ys), yMax=Math.max(...ys); const yScale=y=> H-20 - (y - yMin)*(H-40)/(yMax-yMin||1); const d=pts.map((p,i)=> (i?'L':'M') + xScale(p[0])+','+yScale(p[1])).join(' '); return d; } svg.innerHTML = `<path d="${scale(pts0)}" fill="none" stroke="#8892b0" stroke-width="2"/><path d="${scale(pts1)}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--brand')}" stroke-width="2"/>`; }
function drawAttrib(){ const svg=document.getElementById('attribChart'); const W=svg.clientWidth||560,H=svg.clientHeight||260; svg.setAttribute('viewBox',`0 0 ${W} ${H}`); const w=weights(); const groups=[['Equity', w.filter(x=>x.assetClass==='Equity'||x.subType==='Equity ETF').reduce((s,x)=>s+x.w,0)],['Bonds', w.filter(x=>x.subType==='Bond ETF').reduce((s,x)=>s+x.w,0)],['Cmdty', w.filter(x=> (DB_MAP.get(x.symbol)||{}).subType==='Commodity ETF').reduce((s,x)=>s+x.w,0)],['Crypto', w.filter(x=>x.assetClass==='Crypto').reduce((s,x)=>s+x.w,0)]]; const barW=(W-80)/groups.length, maxH=H-60; svg.innerHTML=''; groups.forEach((g,i)=>{ const v=g[1]; const h=v*maxH; const x=40+i*barW+10; const y=H-30-h; const rect = `<rect x="${x}" y="${y}" width="${barW-20}" height="${h}" fill="${getComputedStyle(document.documentElement).getPropertyValue('--accent')}" />`; const label = `<text x="${x+(barW-20)/2}" y="${H-12}" fill="#cbd5e1" font-size="12" text-anchor="middle">${g[0]}</text>`; const val = `<text x="${x+(barW-20)/2}" y="${y-6}" fill="#cbd5e1" font-size="12" text-anchor="middle">${(v*100).toFixed(1)}%</text>`; svg.innerHTML += rect + label + val; }); }

// Theme toggle
(function(){ const btn=document.getElementById('themeBtn'); if(btn){ btn.onclick=()=>{ document.body.classList.toggle('light'); btn.textContent=document.body.classList.contains('light')?'Dark Mode':'Light Mode'; }; }})();
// Help button
document.getElementById('helpBtn')?.addEventListener('click', ()=>{ alert('Help/Glossary coming soon: plain-English explanations of returns, volatility, Sharpe, Sortino, drawdown, VaR/ES, diversification, beta and rebalancing.'); });
// AI Insights
(function(){ const box=document.getElementById('aiBox'); const btn=document.getElementById('runAI'); if(!box||!btn) return; function fmtpct(x){ return (x*100).toFixed(1)+'%'; } btn.onclick=()=>{ const Wt=weights(); if(!Wt.length){ box.innerHTML='No holdings yet. Add assets or pick a preset, then try again.'; return; } const totalVol=Wt.reduce((s,x)=>s+x.w*(x.vol/100),0); const expRet=Wt.reduce((s,x)=>s+x.w*(x.ret/100),0); const classAgg={}; Wt.forEach(x=>{ classAgg[x.assetClass]=(classAgg[x.assetClass]||0)+x.w; }); const riskContr=Wt.map(x=>({ sym:x.symbol, rc:x.w*(x.vol/100) })).sort((a,b)=>b.rc-a.rc).slice(0,5); const divScore=1 - Wt.reduce((s,x)=>s+x.w*x.w,0); const dd=Math.min(0.35, 2.5*totalVol); const bullets=[ `<b>Allocation Mix</b>: ${Object.entries(classAgg).map(([k,v])=>k+': '+fmtpct(v)).join(' • ')}`, `<b>Expected Return</b>: ${(expRet*100).toFixed(1)}%  •  <b>Volatility (est.)</b>: ${(totalVol*100).toFixed(1)}%`, `<b>Diversification Score</b>: ${(divScore*100).toFixed(0)}/100 (higher is better)`, `<b>Max Drawdown (heuristic)</b>: ${(dd*100).toFixed(0)}%`, `<b>Top Risk Contributors</b>: ${riskContr.map(r=>r.sym+' '+(r.rc*100).toFixed(1)+'%').join(', ')}` ]; box.innerHTML = '<ul style="margin:0 0 0 18px"><li>' + bullets.join('</li><li>') + '</li></ul>'; }; })();

// Export CSVs & PDF
function download(filename, text){ const blob=new Blob([text],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000); }
document.getElementById('exportBtn').onclick=()=>{ const rows=['symbol,name,units,price,value']; portfolio.forEach(h=>rows.push([h.symbol,'\"'+h.name+'\"',h.units,h.price,(h.units*h.price).toFixed(2)].join(','))); download('portfolio.csv', rows.join('\\n')); };
document.getElementById('exportAll').onclick=()=>{ const rows=['symbol,name,assetClass,subType,group,price,vol,ret1y']; DB.forEach(d=>rows.push([d.symbol,'\"'+d.name+'\"',d.assetClass,d.subType,d.group,d.price,d.vol,d.ret1y].join(','))); download('reference_db.csv', rows.join('\\n')); };
document.getElementById('exportPDF').onclick=()=>{ window.print(); };

function recalc(){ const total=portfolio.reduce((s,h)=>s+h.units*h.price,0); totalValEl.textContent=formatMoney(total); drawKPIs(); drawTreemap(); drawCorr(); drawLine(); drawRebal(); drawNarrative(); drawScenario(); drawAttrib(); }
recalc();
</script>
</body>
</html>
